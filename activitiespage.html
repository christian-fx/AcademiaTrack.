<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Activity Tracker - AcademiaTrack</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#135bec",
              "background-light": "#f6f6f8",
              "background-dark": "#101622",
              "success": "#10B981",
              "warning": "#F59E0B",
              "error": "#EF4444",
              "info": "#3B82F6"
            },
            fontFamily: {
              "display": ["Lexend", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
          },
        },
      }
    </script>
    <style>
        /* Mobile Menu Styles */
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .mobile-menu.open {
            transform: translateX(0);
        }
        
        .menu-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        
        .menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background-color: #10B981;
        }
        
        .toast.error {
            background-color: #EF4444;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Add Activity Modal -->
    <div id="activity-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white dark:bg-background-dark rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">Add New Activity</h3>
            <form id="activity-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Activity Name</label>
                    <input type="text" id="activity-name" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary" placeholder="e.g., Midterm Exam, Lab Report" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Activity Type</label>
                    <select id="activity-type" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary" required>
                        <option value="">Select Type</option>
                        <option value="assignment">Assignment</option>
                        <option value="test">Test</option>
                        <option value="practical">Practical</option>
                        <option value="exam">Exam</option>
                        <option value="project">Project</option>
                        <option value="presentation">Presentation</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Course/Subject</label>
                    <input type="text" id="activity-course" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary" placeholder="e.g., Computer Science 101" required>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Due Date</label>
                        <input type="date" id="activity-date" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Due Time</label>
                        <input type="time" id="activity-time" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary" value="23:59">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Priority</label>
                    <select id="activity-priority" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Description (Optional)</label>
                    <textarea id="activity-description" rows="3" class="w-full bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg p-3 text-sm focus:ring-primary focus:border-primary" placeholder="Add any additional details..."></textarea>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" id="cancel-activity" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg h-10 font-medium">Cancel</button>
                    <button type="submit" class="flex-1 bg-primary text-white rounded-lg h-10 font-medium">Add Activity</button>
                </div>
            </form>
        </div>
    </div>

    <div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">
            <div class="flex flex-1 justify-center py-5">
                <div class="layout-content-container flex flex-col w-full max-w-5xl flex-1 px-4 md:px-8 lg:px-0">
                    <!-- TopNavBar -->
                    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-700 px-4 md:px-10 py-4 mb-8 bg-white/50 dark:bg-black/20 rounded-xl backdrop-blur-sm">
                        <div class="flex items-center gap-4 text-gray-900 dark:text-white">
                            <div class="size-6 text-primary">
                                <svg fill="currentColor" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_6_330)">
                                        <path clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor" fill-rule="evenodd"></path>
                                    </g>
                                    <defs>
                                        <clippath id="clip0_6_330"><rect fill="white" height="48" width="48"></rect></clippath>
                                    </defs>
                                </svg>
                            </div>
                            <h2 class="text-lg font-bold tracking-tight">AcademiaTrack</h2>
                        </div>
                        <div class="hidden md:flex flex-1 justify-end gap-8">
                            <div class="flex items-center gap-9">
                                <a class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="homepage.html">Dashboard</a>
                                <a class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="progresspage.html">Progress</a>
                                <a class="text-sm font-medium text-primary dark:text-primary" href="#">Activities</a>
                                <a class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="profile-page.html">Profile</a>
                            </div>
                            <div class="flex items-center gap-3">
                                <span id="user-name" class="text-sm font-medium text-gray-700 dark:text-gray-300"></span>
                                <div id="profile-image" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-white dark:border-gray-800 shadow-sm"></div>
                            </div>
                        </div>
                        <button id="menu-toggle" class="md:hidden p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800">
                            <span class="material-symbols-outlined text-gray-800 dark:text-gray-200">menu</span>
                        </button>
                    </header>

                    <!-- Mobile Menu -->
                    <div id="mobile-menu" class="mobile-menu fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg z-50 md:hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center gap-3">
                                <div class="size-6 text-primary">
                                    <svg fill="currentColor" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_6_330)">
                                            <path clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor" fill-rule="evenodd"></path>
                                        </g>
                                    </svg>
                                </div>
                                <h2 class="text-lg font-bold">AcademiaTrack</h2>
                            </div>
                        </div>
                  <nav class="p-4">
                            <ul class="space-y-4">
                                <li>
                                    <a href="homepage.html" class="block text-gray-800 dark:text-gray-200 hover:text-primary dark:hover:text-primary py-2">Dashboard</a>
                                </li>
                               <li>
                                    <a href="homepage.html" class="block text-primary font-medium py-2">Activities</a>
                                </li>
                                       <li>
                                    <a href="progresspage.html" class="block text-gray-800 dark:text-gray-200 hover:text-primary dark:hover:text-primary py-2">Progress</a>
                                </li>
                                <li>
                                    <a href="profile-page.html" class="block text-gray-800 dark:text-gray-200 hover:text-primary dark:hover:text-primary py-2">Profile</a>
                                </li>
                                            <li>
                        <a href="chatbot.html" class="block text-gray-800 dark:text-gray-200 hover:text-primary dark:hover:text-primary py-2">ChatBot</a>
                    </li>
                                <li class="pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button id="mobile-logout" class="block w-full text-center bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                                        Logout
                                    </button>
                                </li>
                            </ul>
                        </nav>
                    </div>

                    <!-- Menu Overlay -->
                    <div id="menu-overlay" class="menu-overlay fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>

                    <main class="flex flex-col gap-8 w-full">
                        <!-- PageHeading -->
                        <div class="flex flex-wrap justify-between items-center gap-4 px-4">
                            <div class="flex min-w-72 flex-col gap-2">
                                <p class="text-gray-900 dark:text-white text-3xl lg:text-4xl font-black leading-tight tracking-tighter">Activity Tracker</p>
                                <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">Manage your assignments, tests, and deadlines in one place.</p>
                            </div>
                            <button id="add-activity-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] gap-2">
                                <span class="material-symbols-outlined text-xl">add</span>
                                <span class="truncate">Add Activity</span>
                            </button>
                        </div>

                        <!-- Activity Stats -->
                        <div class="px-4">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                                    <div class="text-2xl font-bold text-primary" id="total-activities">0</div>
                                    <div class="text-gray-600 dark:text-gray-400 text-sm">Total Activities</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                                    <div class="text-2xl font-bold text-warning" id="pending-activities">0</div>
                                    <div class="text-gray-600 dark:text-gray-400 text-sm">Pending</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                                    <div class="text-2xl font-bold text-success" id="completed-activities">0</div>
                                    <div class="text-gray-600 dark:text-gray-400 text-sm">Completed</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                                    <div class="text-2xl font-bold text-error" id="overdue-activities">0</div>
                                    <div class="text-gray-600 dark:text-gray-400 text-sm">Overdue</div>
                                </div>
                            </div>
                        </div>

                        <!-- Filter and Search -->
                        <div class="px-4">
                            <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700">
                                <div class="flex flex-wrap gap-3">
                                    <button class="filter-btn active px-3 py-1 rounded-full bg-primary text-white text-sm font-medium" data-filter="all">All</button>
                                    <button class="filter-btn px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-medium" data-filter="pending">Pending</button>
                                    <button class="filter-btn px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-medium" data-filter="completed">Completed</button>
                                    <button class="filter-btn px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-medium" data-filter="overdue">Overdue</button>
                                </div>
                                <div class="flex gap-2 w-full sm:w-auto">
                                    <input type="text" id="search-activities" placeholder="Search activities..." class="flex-1 sm:w-64 bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary">
                                    <select id="sort-activities" class="bg-background-light dark:bg-background-dark border border-gray-300 dark:border-gray-700 rounded-lg h-10 px-3 text-sm focus:ring-primary focus:border-primary">
                                        <option value="date-desc">Due Date (latest)</option>
                                        <option value="date-asc">Due Date (oldest)</option>
                                        <option value="priority">Priority</option>
                                        <option value="name">Name</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Activities Section -->
                        <div class="px-4">
                            <div class="mb-6">
                                <h3 class="text-gray-900 dark:text-white text-xl font-bold leading-tight mb-4">Upcoming Activities</h3>
                                <div id="upcoming-activities" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <!-- Upcoming activities will be dynamically added here -->
                                </div>
                            </div>

                            <div class="mb-6">
                                <h3 class="text-gray-900 dark:text-white text-xl font-bold leading-tight mb-4">All Activities</h3>
                                <div id="activities-list" class="space-y-3">
                                    <!-- All activities will be dynamically added here -->
                                </div>
                            </div>

                            <!-- Empty State -->
                            <div id="empty-state" class="hidden text-center py-12">
                                <div class="max-w-md mx-auto">
                                    <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-gray-600 mb-4">assignment</span>
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">No activities yet</h3>
                                    <p class="text-gray-500 dark:text-gray-400 mb-6">Start by adding your first assignment, test, or project deadline.</p>
                                    <button id="add-first-activity" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                                        Add Your First Activity
                                    </button>
                                </div>
                            </div>
                        </div>
                    </main>

                    <!-- Footer -->
                    <footer class="w-full mt-16 border-t border-gray-200 dark:border-gray-700 pt-8 pb-12">
                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 px-4">
                            <div class="flex items-center gap-4 text-gray-900 dark:text-white mb-4 sm:mb-0">
                                <div class="size-6 text-primary">
                                    <svg fill="currentColor" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_6_330)">
                                            <path clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor" fill-rule="evenodd"></path>
                                        </g>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-bold">AcademiaTrack</h3>
                            </div>
                            <div class="flex flex-col sm:flex-row items-center gap-6 text-sm">
                                <div class="flex items-center gap-6 mb-4 sm:mb-0">
                                    <a class="text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary" href="homepage.html">Dashboard</a>
                                    <a class="text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary" href="progresspage.html">Progress</a>
                                    <a class="text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary" href="#">Activities</a>
                                </div>
                                <div class="flex items-center gap-6">
                                    <a class="text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary" href="profile-page.html">Profile</a>
                                    <a class="text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary" href="help.html">Help</a>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-6">
                            <p class="text-gray-500 dark:text-gray-400 text-sm">Â© 2025 AcademiaTrack. Never miss a deadline again.</p>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu functionality
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuOverlay = document.getElementById('menu-overlay');

        function toggleMenu() {
            mobileMenu.classList.toggle('open');
            menuOverlay.classList.toggle('open');
            document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
        }

        menuToggle.addEventListener('click', toggleMenu);
        menuOverlay.addEventListener('click', toggleMenu);

        // Close menu when clicking on links
        const menuLinks = document.querySelectorAll('#mobile-menu a');
        menuLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('open');
                menuOverlay.classList.remove('open');
                document.body.style.overflow = '';
            });
        });

        // Logout functionality
        document.getElementById('mobile-logout').addEventListener('click', function() {
            firebaseUtils.signOut().then(() => {
                localStorage.removeItem('academiatrack_current_user');
                window.location.href = 'login-page.html';
            });
        });

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Activity Management
        let currentUser = null;
        let userData = null;
        let currentFilter = 'all';
        let currentSort = 'date-desc';

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            firebaseUtils.getCurrentUser().then(user => {
                if (!user) {
                    window.location.href = 'login-page.html';
                    return;
                }

                currentUser = user;
                
                // Get user data from Firebase
                firebaseUtils.getUserData(user.uid).then(data => {
                    if (data) {
                        userData = data;
                        
                        // Initialize activities if they don't exist
                        if (!userData.activities) {
                            userData.activities = [];
                        }

                        // Update user info
                        document.getElementById('user-name').textContent = userData.fullName;
                        if (userData.profileImage) {
                            document.getElementById('profile-image').style.backgroundImage = `url(${userData.profileImage})`;
                        }

                        loadActivities();
                        setupEventListeners();
                    } else {
                        console.error('User data not found');
                        window.location.href = 'login-page.html';
                    }
                }).catch(error => {
                    console.error('Error fetching user data:', error);
                    window.location.href = 'login-page.html';
                });
            });
        });

        function setupEventListeners() {
            // Activity modal
            const activityModal = document.getElementById('activity-modal');
            const addActivityBtn = document.getElementById('add-activity-btn');
            const addFirstActivityBtn = document.getElementById('add-first-activity');
            const cancelActivityBtn = document.getElementById('cancel-activity');
            const activityForm = document.getElementById('activity-form');

            addActivityBtn.addEventListener('click', () => activityModal.classList.remove('hidden'));
            addFirstActivityBtn.addEventListener('click', () => activityModal.classList.remove('hidden'));
            cancelActivityBtn.addEventListener('click', () => {
                activityModal.classList.add('hidden');
                activityForm.reset();
            });

            activityForm.addEventListener('submit', function(e) {
                e.preventDefault();
                addNewActivity();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300'));
                    
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    this.classList.add('active', 'bg-primary', 'text-white');
                    
                    currentFilter = this.dataset.filter;
                    loadActivities();
                });
            });

            // Search and sort
            document.getElementById('search-activities').addEventListener('input', loadActivities);
            document.getElementById('sort-activities').addEventListener('change', function() {
                currentSort = this.value;
                loadActivities();
            });

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('activity-date').min = today;
        }

        function addNewActivity() {
            const name = document.getElementById('activity-name').value;
            const type = document.getElementById('activity-type').value;
            const course = document.getElementById('activity-course').value;
            const date = document.getElementById('activity-date').value;
            const time = document.getElementById('activity-time').value;
            const priority = document.getElementById('activity-priority').value;
            const description = document.getElementById('activity-description').value;

            const activity = {
                id: `activity-${Date.now()}`,
                name: name,
                type: type,
                course: course,
                dueDate: `${date}T${time}`,
                priority: priority,
                description: description,
                completed: false,
                createdAt: new Date().toISOString()
            };

            userData.activities.push(activity);
            saveUserData();
            
            document.getElementById('activity-modal').classList.add('hidden');
            document.getElementById('activity-form').reset();
            
            showToast('Activity added successfully!');
            loadActivities();
        }

        function loadActivities() {
            const searchTerm = document.getElementById('search-activities').value.toLowerCase();
            let activities = userData.activities || [];

            // Filter activities
            if (searchTerm) {
                activities = activities.filter(activity => 
                    activity.name.toLowerCase().includes(searchTerm) ||
                    activity.course.toLowerCase().includes(searchTerm) ||
                    activity.type.toLowerCase().includes(searchTerm)
                );
            }

            // Apply status filter
            const now = new Date();
            activities = activities.filter(activity => {
                const dueDate = new Date(activity.dueDate);
                const isOverdue = dueDate < now && !activity.completed;
                const isPending = !activity.completed && !isOverdue;
                const isCompleted = activity.completed;

                switch (currentFilter) {
                    case 'pending': return isPending;
                    case 'completed': return isCompleted;
                    case 'overdue': return isOverdue;
                    default: return true;
                }
            });

            // Sort activities
            activities.sort((a, b) => {
                switch (currentSort) {
                    case 'date-asc':
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    case 'priority':
                        const priorityOrder = { 'urgent': 0, 'high': 1, 'medium': 2, 'low': 3 };
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    case 'name':
                        return a.name.localeCompare(b.name);
                    default: // date-desc
                        return new Date(b.dueDate) - new Date(a.dueDate);
                }
            });

            updateActivityStats();
            displayActivities(activities);
        }

        function updateActivityStats() {
            const activities = userData.activities || [];
            const now = new Date();

            const total = activities.length;
            const completed = activities.filter(a => a.completed).length;
            const overdue = activities.filter(a => {
                const dueDate = new Date(a.dueDate);
                return dueDate < now && !a.completed;
            }).length;
            const pending = total - completed - overdue;

            document.getElementById('total-activities').textContent = total;
            document.getElementById('completed-activities').textContent = completed;
            document.getElementById('overdue-activities').textContent = overdue;
            document.getElementById('pending-activities').textContent = pending;
        }

        function displayActivities(activities) {
            const upcomingContainer = document.getElementById('upcoming-activities');
            const allContainer = document.getElementById('activities-list');
            const emptyState = document.getElementById('empty-state');

            upcomingContainer.innerHTML = '';
            allContainer.innerHTML = '';

            if (activities.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            // Separate upcoming activities (next 7 days)
            const now = new Date();
            const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const upcomingActivities = activities.filter(activity => {
                const dueDate = new Date(activity.dueDate);
                return dueDate >= now && dueDate <= nextWeek && !activity.completed;
            }).slice(0, 6); // Show max 6 upcoming activities

            // Display upcoming activities
            if (upcomingActivities.length > 0) {
                upcomingActivities.forEach(activity => {
                    const activityElement = createActivityCard(activity);
                    upcomingContainer.appendChild(activityElement);
                });
            } else {
                upcomingContainer.innerHTML = `
                    <div class="col-span-3 text-center py-8 text-gray-500 dark:text-gray-400">
                        <span class="material-symbols-outlined text-4xl mb-2">event_available</span>
                        <p>No upcoming activities in the next 7 days</p>
                    </div>
                `;
            }

            // Display all activities
            activities.forEach(activity => {
                const activityElement = createActivityListItem(activity);
                allContainer.appendChild(activityElement);
            });
        }

        function createActivityCard(activity) {
            const element = document.createElement('div');
            element.className = 'fade-in bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm';
            
            const dueDate = new Date(activity.dueDate);
            const now = new Date();
            const timeDiff = dueDate - now;
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            
            const priorityColors = {
                'low': 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-400',
                'medium': 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-400',
                'high': 'bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-400',
                'urgent': 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-400'
            };

            const typeIcons = {
                'assignment': 'description',
                'test': 'quiz',
                'practical': 'biotech',
                'exam': 'school',
                'project': 'folder',
                'presentation': 'presentation'
            };

            element.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-${getPriorityColor(activity.priority)}">${typeIcons[activity.type] || 'assignment'}</span>
                        <span class="text-xs font-medium px-2 py-1 rounded-full ${priorityColors[activity.priority]}">${activity.priority}</span>
                    </div>
                    <button class="activity-action p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-id="${activity.id}" data-action="toggle">
                        <span class="material-symbols-outlined text-lg ${activity.completed ? 'text-green-600' : 'text-gray-400'}">${activity.completed ? 'check_circle' : 'radio_button_unchecked'}</span>
                    </button>
                </div>
                <h4 class="font-bold text-gray-800 dark:text-gray-200 mb-2 truncate">${activity.name}</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3 truncate">${activity.course}</p>
                <div class="flex justify-between items-center">
                    <span class="text-xs ${getDueDateColor(daysDiff)}">${getDueDateText(daysDiff)}</span>
                    <span class="text-xs text-gray-500">${formatDate(activity.dueDate)}</span>
                </div>
                <div class="flex justify-between mt-3">
                    <button class="activity-action text-xs text-primary hover:text-primary/80" data-id="${activity.id}" data-action="edit">Edit</button>
                    <button class="activity-action text-xs text-red-600 hover:text-red-800" data-id="${activity.id}" data-action="delete">Delete</button>
                </div>
            `;

            // Add event listeners
            element.querySelectorAll('.activity-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const activityId = this.dataset.id;
                    handleActivityAction(activityId, action);
                });
            });

            return element;
        }

        function createActivityListItem(activity) {
            const element = document.createElement('div');
            element.className = `fade-in bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm ${activity.completed ? 'opacity-60' : ''}`;
            
            const dueDate = new Date(activity.dueDate);
            const now = new Date();
            const timeDiff = dueDate - now;
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            
            const typeIcons = {
                'assignment': 'description',
                'test': 'quiz',
                'practical': 'biotech',
                'exam': 'school',
                'project': 'folder',
                'presentation': 'presentation'
            };

            element.innerHTML = `
                <div class="flex items-center gap-4">
                    <button class="activity-action flex-shrink-0" data-id="${activity.id}" data-action="toggle">
                        <span class="material-symbols-outlined text-xl ${activity.completed ? 'text-green-600' : 'text-gray-400'}">${activity.completed ? 'check_circle' : 'radio_button_unchecked'}</span>
                    </button>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-${getPriorityColor(activity.priority)} text-sm">${typeIcons[activity.type] || 'assignment'}</span>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 truncate ${activity.completed ? 'line-through' : ''}">${activity.name}</h4>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">${activity.course}</p>
                        <div class="flex items-center gap-4 text-xs text-gray-500">
                            <span>${formatDateTime(activity.dueDate)}</span>
                            <span class="capitalize">${activity.priority} priority</span>
                            ${activity.description ? '<span class="truncate">' + activity.description + '</span>' : ''}
                        </div>
                    </div>
                    <div class="flex items-center gap-2 flex-shrink-0">
                        <span class="text-xs px-2 py-1 rounded-full ${getDueDateColor(daysDiff)}">${getDueDateText(daysDiff)}</span>
                        <button class="activity-action p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-id="${activity.id}" data-action="edit">
                            <span class="material-symbols-outlined text-lg">edit</span>
                        </button>
                        <button class="activity-action p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-id="${activity.id}" data-action="delete">
                            <span class="material-symbols-outlined text-lg text-red-600">delete</span>
                        </button>
                    </div>
                </div>
            `;

            // Add event listeners
            element.querySelectorAll('.activity-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const activityId = this.dataset.id;
                    handleActivityAction(activityId, action);
                });
            });

            return element;
        }

        function handleActivityAction(activityId, action) {
            const activity = userData.activities.find(a => a.id === activityId);
            if (!activity) return;

            switch (action) {
                case 'toggle':
                    activity.completed = !activity.completed;
                    saveUserData();
                    loadActivities();
                    showToast(activity.completed ? 'Activity marked as completed!' : 'Activity marked as pending!');
                    break;
                
                case 'delete':
                    if (confirm('Are you sure you want to delete this activity?')) {
                        userData.activities = userData.activities.filter(a => a.id !== activityId);
                        saveUserData();
                        loadActivities();
                        showToast('Activity deleted successfully!');
                    }
                    break;
                
                case 'edit':
                    // For simplicity, we'll delete and re-add
                    if (confirm('Edit this activity? We\'ll recreate it with your changes.')) {
                        userData.activities = userData.activities.filter(a => a.id !== activityId);
                        saveUserData();
                        document.getElementById('activity-modal').classList.remove('hidden');
                        // Pre-fill form would go here in a more complex implementation
                        loadActivities();
                    }
                    break;
            }
        }

        // Utility functions
        function getPriorityColor(priority) {
            const colors = {
                'low': 'green-600',
                'medium': 'blue-600',
                'high': 'orange-600',
                'urgent': 'red-600'
            };
            return colors[priority] || 'gray-600';
        }

        function getDueDateColor(daysDiff) {
            if (daysDiff < 0) return 'text-red-600 font-semibold';
            if (daysDiff === 0) return 'text-red-600 font-semibold';
            if (daysDiff <= 3) return 'text-orange-600 font-semibold';
            if (daysDiff <= 7) return 'text-yellow-600';
            return 'text-gray-600';
        }

        function getDueDateText(daysDiff) {
            if (daysDiff < 0) return 'Overdue';
            if (daysDiff === 0) return 'Due today';
            if (daysDiff === 1) return 'Due tomorrow';
            if (daysDiff <= 7) return `Due in ${daysDiff} days`;
            return `Due in ${daysDiff} days`;
        }

        function formatDate(dateString) {
            const options = { month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function formatDateTime(dateString) {
            const options = { 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function saveUserData() {
            // Update user data in Firebase
            firebaseUtils.updateUserData(currentUser.uid, userData).then(() => {
                // Also update localStorage for quick access
                localStorage.setItem('academiatrack_current_user', JSON.stringify(userData));
            }).catch(error => {
                console.error('Error saving user data:', error);
                showToast('Error saving activity data', 'error');
            });
        }

        // Auto-refresh activities
        setInterval(() => {
            if (userData) {
                loadActivities();
            }
        }, 30000);
    </script>
</body>
</html>